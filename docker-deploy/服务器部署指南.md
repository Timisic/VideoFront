# ğŸ“¦ Docker é•œåƒæœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1ï¸âƒ£ ä¸Šä¼ é•œåƒæ–‡ä»¶
å°† `psychological-assessment.tar.gz` ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š
```bash
# ç›®æ ‡è·¯å¾„
/home/ubuntu/hwj/psychological-assessment.tar.gz
```

### 2ï¸âƒ£ ç¡®è®¤åç«¯æœåŠ¡
ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
- **åç«¯åœ°å€**: `http://192.168.8.167:8080`
- **API ç«¯ç‚¹**: `/api/v1/analysis/face_video`

âš ï¸ **é‡è¦**: Docker å®¹å™¨éœ€è¦é€šè¿‡ `host.docker.internal` è®¿é—®å®¿ä¸»æœºæœåŠ¡

---

## ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: SSH ç™»å½•æœåŠ¡å™¨
```bash
ssh ubuntu@192.168.8.167
```

### æ­¥éª¤ 2: è¿›å…¥éƒ¨ç½²ç›®å½•
```bash
cd /home/ubuntu/hwj/
```

### æ­¥éª¤ 3: è§£å‹é•œåƒæ–‡ä»¶
```bash
gunzip -f psychological-assessment.tar.gz
```
æ‰§è¡Œåä¼šå¾—åˆ° `psychological-assessment.tar` æ–‡ä»¶

### æ­¥éª¤ 4: åŠ è½½ Docker é•œåƒ
```bash
docker load < psychological-assessment.tar
```
æŸ¥çœ‹æ˜¯å¦åŠ è½½æˆåŠŸï¼š
```bash
docker images | grep psychological-assessment
```

### æ­¥éª¤ 5: åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
```bash
docker stop psychological-assessment 2>/dev/null || true
docker rm psychological-assessment 2>/dev/null || true
```

### æ­¥éª¤ 6: è¿è¡Œæ–°å®¹å™¨
```bash
docker run -d \
  --name psychological-assessment \
  -p 20053:20053 \
  --restart unless-stopped \
  --add-host host.docker.internal:host-gateway \
  psychological-assessment:latest
```

**å‚æ•°è¯´æ˜**:
- `-d`: åå°è¿è¡Œ
- `--name`: å®¹å™¨åç§°
- `-p 20053:20053`: ç«¯å£æ˜ å°„ï¼ˆå®¿ä¸»æœº:å®¹å™¨ï¼‰
- `--restart unless-stopped`: è‡ªåŠ¨é‡å¯
- `--add-host host.docker.internal:host-gateway`: å…è®¸å®¹å™¨è®¿é—®å®¿ä¸»æœºæœåŠ¡

### æ­¥éª¤ 7: éªŒè¯å®¹å™¨çŠ¶æ€
```bash
# æŸ¥çœ‹å®¹å™¨æ˜¯å¦è¿è¡Œ
docker ps | grep psychological-assessment

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs psychological-assessment --tail 50

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f psychological-assessment
```

### æ­¥éª¤ 8: æ¸…ç†ä¸´æ—¶æ–‡ä»¶
```bash
rm psychological-assessment.tar
```

---

## ğŸŒ è®¿é—®åº”ç”¨

éƒ¨ç½²æˆåŠŸåï¼Œé€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š
```
http://159.226.113.201:20053/
```

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æœ€æ–° 50 è¡Œæ—¥å¿—
docker logs psychological-assessment --tail 50

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f psychological-assessment
```

### é‡å¯å®¹å™¨
```bash
docker restart psychological-assessment
```

### åœæ­¢å®¹å™¨
```bash
docker stop psychological-assessment
```

### å¯åŠ¨å®¹å™¨
```bash
docker start psychological-assessment
```

### åˆ é™¤å®¹å™¨
```bash
docker stop psychological-assessment
docker rm psychological-assessment
```

### åˆ é™¤é•œåƒ
```bash
docker rmi psychological-assessment:latest
```

### è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰
```bash
docker exec -it psychological-assessment sh
```

---

## âš ï¸ åç«¯è¿æ¥é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: å®¹å™¨å†…æ— æ³•è®¿é—®åç«¯
**ç°è±¡**: å‰ç«¯é¡µé¢åŠ è½½æ­£å¸¸ï¼Œä½†æäº¤è§†é¢‘åæŠ¥é”™

**åŸå› **: å®¹å™¨å†…çš„ Nginx ä»£ç†é…ç½®å¯èƒ½æ— æ³•è®¿é—® `192.168.8.167:8080`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦åœ¨å®¿ä¸»æœºè¿è¡Œï¼š
   ```bash
   curl http://192.168.8.167:8080/api/v1/analysis/face_video
   ```

2. å¦‚æœåç«¯åœ¨å®¿ä¸»æœºï¼Œå®¹å™¨åº”è¯¥é€šè¿‡ `host.docker.internal` è®¿é—®
   - å·²åœ¨å¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ  `--add-host host.docker.internal:host-gateway`

3. æ£€æŸ¥å®¹å™¨å†…çš„ Nginx é…ç½®ï¼ˆå¦‚æœéœ€è¦ä¿®æ”¹ï¼‰ï¼š
   ```bash
   docker exec -it psychological-assessment cat /etc/nginx/nginx.conf
   ```

### é—®é¢˜ 2: ç«¯å£è¢«å ç”¨
**ç°è±¡**: å¯åŠ¨å®¹å™¨æ—¶æŠ¥é”™ `port is already allocated`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹å ç”¨ 20053 ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :20053

# åœæ­¢å ç”¨ç«¯å£çš„å®¹å™¨
docker ps | grep 20053
docker stop <å®¹å™¨ID>
```

### é—®é¢˜ 3: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º
**ç°è±¡**: `docker ps` çœ‹ä¸åˆ°å®¹å™¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰
docker ps -a | grep psychological-assessment

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—æ‰¾å‡ºé”™è¯¯åŸå› 
docker logs psychological-assessment
```

---

## ğŸ“Š å¥åº·æ£€æŸ¥

éƒ¨ç½²å®Œæˆåï¼Œå»ºè®®è¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

### âœ… æ£€æŸ¥æ¸…å•
- [ ] å®¹å™¨æ­£åœ¨è¿è¡Œ (`docker ps`)
- [ ] å‰ç«¯é¡µé¢å¯ä»¥è®¿é—® (`http://159.226.113.201:20053/`)
- [ ] åç«¯æœåŠ¡æ­£å¸¸ (`http://192.168.8.167:8080`)
- [ ] è§†é¢‘ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] æŠ¥å‘Šç”ŸæˆåŠŸèƒ½æ­£å¸¸

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

å¦‚æœéœ€è¦æ›´æ–°åº”ç”¨ï¼š
1. é‡æ–°æ„å»ºé•œåƒï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œ `./build-docker-local.sh`ï¼‰
2. ä¸Šä¼ æ–°çš„ `psychological-assessment.tar.gz`
3. é‡å¤ä¸Šè¿°éƒ¨ç½²æ­¥éª¤

---

## ğŸ“ å¤‡æ³¨

- é•œåƒæ–‡ä»¶è¾ƒå¤§ï¼Œä¸Šä¼ å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´
- é¦–æ¬¡å¯åŠ¨å®¹å™¨å¯èƒ½éœ€è¦å‡ ç§’é’Ÿåˆå§‹åŒ–
- å»ºè®®å®šæœŸæŸ¥çœ‹æ—¥å¿—ç¡®ä¿æœåŠ¡æ­£å¸¸è¿è¡Œ
- ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½® HTTPS å’ŒåŸŸå
