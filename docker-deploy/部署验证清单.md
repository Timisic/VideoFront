# 🎉 部署完成检查清单

## 📋 部署前确认

- [ ] 已上传 `docker-deploy/` 目录到服务器
  - `psychological-assessment.tar.gz` (35MB)
  - `ssl/` 目录
  - `deploy-on-server.sh`

## 🚀 部署步骤

```bash
cd /home/ubuntu/hwj/VideoFront/docker-deploy/
chmod +x deploy-on-server.sh
./deploy-on-server.sh
```

## ✅ 部署后验证

### 1. 基础功能
- [ ] HTTPS 页面可访问: `https://159.226.113.201:20443/`
- [ ] 浏览器信任证书（点击"高级" → "继续访问"）
- [ ] 摄像头权限请求正常

### 2. FFmpeg 验证

**在浏览器控制台执行**:
```javascript
// 1. 检查 Cross-Origin-Isolation 是否启用
console.log('crossOriginIsolated:', crossOriginIsolated)
// 期望: true ✅

// 2. 检查 SharedArrayBuffer 是否可用
console.log('SharedArrayBuffer:', typeof SharedArrayBuffer)
// 期望: "function" ✅

// 3. 测试 FFmpeg 文件访问
fetch('/ffmpeg/ffmpeg-core.js').then(r => console.log('JS:', r.status))
fetch('/ffmpeg/ffmpeg-core.wasm').then(r => console.log('WASM:', r.status))
// 期望: 都是 200 ✅
```

### 3. 完整流程测试
- [ ] 点击"开始录制"
- [ ] 录制 3 秒视频
- [ ] 控制台显示 "从本地加载 FFmpeg..."
- [ ] 控制台显示 "FFmpeg 加载成功"
- [ ] 控制台显示 "视频转换成功"
- [ ] 视频成功上传到后端
- [ ] 获得分析结果

## 🐛 问题排查

### 问题 1: crossOriginIsolated = false
**原因**: Cross-Origin-Isolation 头未生效

**检查**:
```bash
curl -I https://159.226.113.201:20443/ | grep -i cross-origin
```
应该看到:
```
cross-origin-embedder-policy: require-corp
cross-origin-opener-policy: same-origin
```

### 问题 2: FFmpeg 加载失败
**查看控制台错误**，可能是:
- MIME 类型错误
- 文件 404
- CORS 问题

### 问题 3: 后端返回 400
**原因**: 视频格式或参数问题

**检查**:
```bash
# 查看容器日志
sudo docker logs psychological-assessment --tail 50

# 查看后端日志
# 检查是否有格式错误信息
```

## 📊 成功标志

**控制台日志应该显示**:
```
开始视频转换...
从本地加载 FFmpeg...
FFmpeg 加载成功
视频转换成功
```

**网络请求应该显示**:
- `/ffmpeg/ffmpeg-core.js` - 200 OK
- `/ffmpeg/ffmpeg-core.wasm` - 200 OK
- `/api/v1/analysis/face_video` - 200 OK

---

## 🎯 如果一切正常

恭喜！您的心理评估应用已成功部署，支持：
- ✅ HTTPS 安全访问
- ✅ 摄像头录制
- ✅ 视频格式转换（WebM → MP4）
- ✅ 后端分析处理
